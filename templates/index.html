<!DOCTYPE html>
{% load static %}
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2563eb">
    <meta name="description" content="MindX Voice - Luy·ªán t·∫≠p giao ti·∫øp v·ªõi ph·ª• huynh qua AI">

    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="MindX Voice">
    <link rel="apple-touch-icon" href="{% static 'icons/icon-192.png' %}">

    <!-- PWA Manifest -->
    <link rel="manifest" href="{% static 'manifest.json' %}">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">

    <title>MindX Voice Chat</title>
</head>


<body>
    <!-- App Container -->
    <div id="app">
        <!-- Loading Screen -->
        <div id="loading-screen" class="loading-screen">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">ƒêang t·∫£i...</span>
            </div>
            <p class="mt-3 text-secondary">ƒêang t·∫£i ·ª©ng d·ª•ng...</p>
        </div>
    </div>

    <!-- Page Templates -->

    <!-- Login Page Template -->
    <template id="login-template">
        <div class="page login-page min-vh-100 d-flex align-items-center justify-content-center">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-12 col-md-6 col-lg-4">
                        <div class="card">
                            <div class="card-body p-4 p-md-5">
                                <!-- Logo -->
                                <div class="text-center mb-4">
                                    <div class="logo-icon mx-auto mb-3">
                                        <i class="bi bi-chat-dots-fill"></i>
                                    </div>
                                    <h1 class="h3 fw-bold text-primary">MindX Voice</h1>
                                    <p class="text-muted">ƒêƒÉng nh·∫≠p ƒë·ªÉ b·∫Øt ƒë·∫ßu luy·ªán t·∫≠p</p>
                                </div>

                                <!-- Login Form -->
                                <form id="login-form">
                                    <div class="mb-3">
                                        <label for="email" class="form-label">Email</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-envelope"></i></span>
                                            <input type="email" class="form-control" id="email"
                                                placeholder="you@example.com" required>
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label for="password" class="form-label">M·∫≠t kh·∫©u</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-lock"></i></span>
                                            <input type="password" class="form-control" id="password"
                                                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                                        </div>
                                    </div>

                                    <div id="login-error" class="alert alert-danger d-none" role="alert"></div>

                                    <button type="submit" class="btn btn-primary w-100 py-2" id="login-btn">
                                        <span class="btn-text">ƒêƒÉng nh·∫≠p</span>
                                        <span class="spinner-border spinner-border-sm d-none ms-2" role="status"></span>
                                    </button>
                                </form>

                                <div class="text-center mt-4">
                                    <small class="text-secondary">Ch∆∞a c√≥ t√†i kho·∫£n? <a href="#"
                                            class="text-primary">ƒêƒÉng k√Ω</a></small>
                                </div>
                            </div>
                        </div>

                        <p class="text-center text-secondary mt-4 small">
                            ¬© 2026 MindX Technology School
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Dashboard Page Template -->
    <template id="dashboard-template">
        <div class="page dashboard-page min-vh-100 d-flex flex-column">
            <!-- Header -->
            <header class="navbar py-3">
                <div class="container">
                    <a class="navbar-brand d-flex align-items-center gap-2" href="#">
                        <div class="logo-icon-sm">
                            <i class="bi bi-chat-dots-fill"></i>
                        </div>
                        <span class="fw-bold">MindX Voice</span>
                    </a>
                    <div class="d-flex align-items-center gap-3">
                        <div class="user-info d-none d-md-flex align-items-center gap-2">
                            <div class="avatar-sm">
                                <i class="bi bi-person-fill"></i>
                            </div>
                            <span class="text-dark" id="user-name">User</span>
                        </div>
                        <button class="btn btn-outline-secondary btn-sm" id="logout-btn">
                            <i class="bi bi-box-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="flex-grow-1 py-4">
                <div class="container">
                    <!-- Welcome Section -->
                    <div class="row mb-4">
                        <div class="col-12 col-md-8">
                            <h2 class="fw-bold mb-2">Xin ch√†o, <span id="welcome-name">b·∫°n</span>! üëã</h2>
                            <p class="text-muted mb-0">S·∫µn s√†ng luy·ªán t·∫≠p giao ti·∫øp v·ªõi ph·ª• huynh h√¥m nay?</p>
                        </div>
                        <div class="col-12 col-md-4 text-md-end mt-3 mt-md-0">
                            <button class="btn btn-primary btn-lg" id="start-session-btn">
                                <i class="bi bi-plus-lg me-2"></i>B·∫Øt ƒë·∫ßu phi√™n m·ªõi
                            </button>
                        </div>
                    </div>

                    <!-- Stats -->
                    <div class="row g-3 mb-4">
                        <div class="col-6 col-md-4">
                            <div class="card stat-card">
                                <div class="card-body d-flex align-items-center gap-3">
                                    <div class="stat-icon bg-primary-subtle">
                                        <i class="bi bi-chat-square-text text-primary"></i>
                                    </div>
                                    <div>
                                        <h3 class="mb-0 fw-bold text-primary" id="stat-total">0</h3>
                                        <small class="text-muted">T·ªïng phi√™n</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-md-4">
                            <div class="card glass-card stat-card">
                                <div class="card-body d-flex align-items-center gap-3">
                                    <div class="stat-icon bg-success-subtle">
                                        <i class="bi bi-check-circle text-success"></i>
                                    </div>
                                    <div>
                                        <h3 class="mb-0 fw-bold text-success" id="stat-completed">0</h3>
                                        <small class="text-muted">Ho√†n th√†nh</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-4">
                            <div class="card glass-card stat-card">
                                <div class="card-body d-flex align-items-center gap-3">
                                    <div class="stat-icon bg-warning-subtle">
                                        <i class="bi bi-star text-warning"></i>
                                    </div>
                                    <div>
                                        <h3 class="mb-0 fw-bold text-warning"><span id="stat-score">0</span>/10</h3>
                                        <small class="text-muted">ƒêi·ªÉm trung b√¨nh</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Personas Section -->
                    <div class="card mb-4">
                        <div class="card-header py-3">
                            <h5 class="mb-0">
                                <i class="bi bi-people me-2 text-primary"></i>Ch·ªçn ph·ª• huynh ƒë·ªÉ luy·ªán t·∫≠p
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3" id="personas-grid">
                                <!-- Personas will be loaded here -->
                                <div class="col-12 text-center py-4">
                                    <div class="spinner-border text-primary" role="status"></div>
                                    <p class="text-secondary mt-2">ƒêang t·∫£i...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Sessions -->
                    <div class="card">
                        <div class="card-header py-3">
                            <h5 class="mb-0">
                                <i class="bi bi-clock-history me-2 text-primary"></i>Phi√™n g·∫ßn ƒë√¢y
                            </h5>
                        </div>
                        <div class="card-body p-0">
                            <div class="list-group list-group-flush" id="sessions-list">
                                <div class="list-group-item bg-transparent text-center py-4">
                                    <p class="text-secondary mb-0">Ch∆∞a c√≥ phi√™n luy·ªán t·∫≠p n√†o</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </template>

    <!-- Scenario Setup Template -->
    <template id="scenario-setup-template">
        <div class="page scenario-page min-vh-100 d-flex flex-column">
            <!-- Header -->
            <header class="navbar py-3">
                <div class="container">
                    <button class="btn btn-link text-primary p-0" id="back-btn">
                        <i class="bi bi-arrow-left fs-5"></i>
                    </button>
                    <span class="navbar-text fw-semibold" id="step-title">Ch·ªçn Persona</span>
                    <div style="width: 24px;"></div>
                </div>
            </header>

            <!-- Progress Steps -->
            <div class="container py-4">
                <div class="step-indicator d-flex justify-content-center align-items-center gap-3 mb-4">
                    <div class="step active" data-step="1">
                        <div class="step-circle"><i class="bi bi-person"></i></div>
                        <span class="step-label d-none d-md-inline">Persona</span>
                    </div>
                    <div class="step-line"></div>
                    <div class="step" data-step="2">
                        <div class="step-circle"><i class="bi bi-sliders"></i></div>
                        <span class="step-label d-none d-md-inline">T√πy ch·ªânh</span>
                    </div>
                    <div class="step-line"></div>
                    <div class="step" data-step="3">
                        <div class="step-circle"><i class="bi bi-check-lg"></i></div>
                        <span class="step-label d-none d-md-inline">X√°c nh·∫≠n</span>
                    </div>
                </div>
            </div>

            <!-- Step Content -->
            <main class="flex-grow-1 overflow-auto">
                <div class="container pb-5">
                    <!-- Step 1: Choose Persona -->
                    <div id="step-1" class="step-content">
                        <div class="text-center mb-4">
                            <h4>Ch·ªçn ph·ª• huynh ƒë·ªÉ luy·ªán t·∫≠p</h4>
                            <p class="text-muted">M·ªói persona c√≥ t√≠nh c√°ch v√† ƒë·ªô kh√≥ kh√°c nhau</p>
                        </div>
                        <div class="row g-3" id="persona-selection">
                            <!-- Loaded dynamically -->
                        </div>
                    </div>

                    <!-- Step 2: Customize -->
                    <div id="step-2" class="step-content d-none">
                        <div class="text-center mb-4">
                            <h4>T√πy ch·ªânh k·ªãch b·∫£n</h4>
                            <p class="text-muted">ƒêi·ªÅu ch·ªânh mode v√† th√™m prompt t√πy ch·ªânh</p>
                        </div>

                        <div class="card mb-4">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-chat me-2 text-primary"></i>Ch·∫ø ƒë·ªô giao ti·∫øp
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="form-check mode-option active mb-3" data-mode="chat">
                                    <input class="form-check-input" type="radio" name="mode" id="mode-chat" value="chat"
                                        checked>
                                    <label class="form-check-label w-100" for="mode-chat">
                                        <div class="d-flex align-items-center gap-3">
                                            <div class="mode-icon"><i class="bi bi-chat-text"></i></div>
                                            <div>
                                                <strong>Chat Text</strong>
                                                <p class="mb-0 small text-secondary">Giao ti·∫øp b·∫±ng tin nh·∫Øn vƒÉn b·∫£n</p>
                                            </div>
                                        </div>
                                    </label>
                                </div>
                                <div class="form-check mode-option disabled">
                                    <input class="form-check-input" type="radio" name="mode" id="mode-voice"
                                        value="voice" disabled>
                                    <label class="form-check-label w-100" for="mode-voice">
                                        <div class="d-flex align-items-center gap-3">
                                            <div class="mode-icon"><i class="bi bi-mic"></i></div>
                                            <div>
                                                <strong class="text-muted">Voice (S·∫Øp ra m·∫Øt)</strong>
                                                <p class="mb-0 small text-secondary">Giao ti·∫øp b·∫±ng gi·ªçng n√≥i</p>
                                            </div>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-magic me-2 text-primary"></i>Custom Prompt
                                    (T√πy ch·ªçn)</h6>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info small mb-3">
                                    <i class="bi bi-info-circle me-2"></i>
                                    Th√™m c√°c y√™u c·∫ßu ƒë·∫∑c bi·ªát cho cu·ªôc h·ªôi tho·∫°i. V√≠ d·ª•: "Ph·ª• huynh ƒëang quan t√¢m v·ªÅ
                                    vi·ªác con h·ªçc k√©m m√¥n To√°n"
                                </div>
                                <textarea class="form-control" id="custom-prompt" rows="4"
                                    placeholder="Nh·∫≠p prompt b·ªï sung t·∫°i ƒë√¢y..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Confirm -->
                    <div id="step-3" class="step-content d-none">
                        <div class="text-center mb-4">
                            <h4>X√°c nh·∫≠n c·∫•u h√¨nh</h4>
                            <p class="text-muted">Ki·ªÉm tra l·∫°i tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu</p>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex align-items-start gap-3 pb-3 border-bottom border-secondary mb-3">
                                    <div class="avatar-lg">
                                        <i class="bi bi-person-fill"></i>
                                    </div>
                                    <div>
                                        <small class="text-secondary">Persona ƒë√£ ch·ªçn</small>
                                        <h5 class="mb-1" id="confirm-persona-name">-</h5>
                                        <span class="badge" id="confirm-persona-difficulty">-</span>
                                        <span class="text-primary small ms-2" id="confirm-persona-personality">-</span>
                                    </div>
                                </div>

                                <div class="d-flex align-items-center gap-3 pb-3 border-bottom border-secondary mb-3">
                                    <div class="mode-icon-lg"><i class="bi bi-chat-text"></i></div>
                                    <div>
                                        <small class="text-secondary">Ch·∫ø ƒë·ªô</small>
                                        <h5 class="mb-0">Chat Text</h5>
                                    </div>
                                </div>

                                <div id="confirm-prompt-section" class="d-none">
                                    <small class="text-secondary">Custom Prompt</small>
                                    <div class="card bg-dark mt-2">
                                        <div class="card-body py-2">
                                            <p class="mb-0 text-light" id="confirm-prompt"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button class="btn btn-primary btn-lg w-100 mt-4" id="start-chat-btn">
                            <i class="bi bi-play-fill me-2"></i>
                            <span class="btn-text">B·∫Øt ƒë·∫ßu luy·ªán t·∫≠p</span>
                            <span class="spinner-border spinner-border-sm d-none ms-2" role="status"></span>
                        </button>
                    </div>
                </div>
            </main>

            <!-- Navigation Footer -->
            <footer class="navbar py-3 bg-white border-top" id="step-nav">
                <div class="container d-flex justify-content-between">
                    <button class="btn btn-outline-secondary" id="prev-step-btn" disabled>
                        <i class="bi bi-arrow-left me-1"></i>Quay l·∫°i
                    </button>
                    <button class="btn btn-primary" id="next-step-btn" disabled>
                        Ti·∫øp t·ª•c<i class="bi bi-arrow-right ms-1"></i>
                    </button>
                </div>
            </footer>
        </div>
    </template>

    <!-- Chat Page Template -->
    <template id="chat-template">
        <div class="page chat-page min-vh-100 d-flex flex-column">
            <!-- Header -->
            <header class="navbar py-2">
                <div class="container">
                    <div class="d-flex align-items-center gap-3">
                        <button class="btn btn-link text-primary p-0" id="chat-back-btn">
                            <i class="bi bi-arrow-left fs-5"></i>
                        </button>
                        <div class="avatar-sm">
                            <i class="bi bi-person-fill"></i>
                        </div>
                        <div>
                            <h6 class="mb-0" id="chat-persona-name">Persona</h6>
                            <small class="text-success"><i class="bi bi-circle-fill me-1"
                                    style="font-size: 6px;"></i>ƒêang ho·∫°t ƒë·ªông</small>
                        </div>
                    </div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-danger btn-sm" id="end-session-btn">
                            <i class="bi bi-flag me-1"></i>K·∫øt th√∫c
                        </button>
                    </div>
                </div>
            </header>

            <!-- Messages Area -->
            <main class="flex-grow-1 overflow-auto" id="messages-container">
                <div class="container py-3">
                    <div id="messages-list">
                        <!-- Welcome Message -->
                        <div class="text-center py-5" id="chat-welcome">
                            <div class="avatar-lg mx-auto mb-3">
                                <i class="bi bi-robot"></i>
                            </div>
                            <h5>B·∫Øt ƒë·∫ßu cu·ªôc tr√≤ chuy·ªán</h5>
                            <p class="text-muted" id="chat-welcome-text">H√£y b·∫Øt ƒë·∫ßu b·∫±ng c√°ch g·ª≠i l·ªùi ch√†o</p>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Error Banner -->
            <div class="alert alert-danger mx-3 mb-0 d-none" id="chat-error">
                <i class="bi bi-exclamation-circle me-2"></i>
                <span id="chat-error-text"></span>
                <button type="button" class="btn-close btn-close-white float-end" aria-label="Close"></button>
            </div>

            <!-- Input Area -->
            <footer class="py-3 bg-white border-top">
                <div class="container">
                    <form id="message-form" class="d-flex gap-2">
                        <textarea class="form-control" id="message-input" rows="1" placeholder="Nh·∫≠p tin nh·∫Øn..."
                            style="resize: none;"></textarea>
                        <button type="submit" class="btn btn-primary px-3" id="send-btn">
                            <i class="bi bi-send-fill" id="send-icon"></i>
                            <span class="spinner-border spinner-border-sm d-none" id="send-spinner"
                                role="status"></span>
                        </button>
                    </form>
                    <small class="text-secondary d-block text-center mt-2">Nh·∫•n Enter ƒë·ªÉ g·ª≠i ‚Ä¢ Shift + Enter ƒë·ªÉ xu·ªëng
                        d√≤ng</small>
                </div>
            </footer>
        </div>
    </template>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- App Scripts -->
    <script src="{% static 'js/api.js' %}"></script>
    <script src="{% static 'js/auth.js' %}"></script>
    <script src="{% static 'js/router.js' %}"></script>
    <script src="{% static 'js/app.js' %}"></script>
</body>

</html>